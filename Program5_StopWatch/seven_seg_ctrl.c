//------------------------------------------------------------------------------
//             __             __   ___  __
//     | |\ | /  ` |    |  | |  \ |__  /__`
//     | | \| \__, |___ \__/ |__/ |___ .__/
//
//------------------------------------------------------------------------------

#include "seven_seg_ctrl.h"

//------------------------------------------------------------------------------
//      __   ___  ___         ___  __
//     |  \ |__  |__  | |\ | |__  /__`
//     |__/ |___ |    | | \| |___ .__/
//
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
//     ___      __   ___  __   ___  ___  __
//      |  \ / |__) |__  |  \ |__  |__  /__`
//      |   |  |    |___ |__/ |___ |    .__/
//
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
//                __          __        ___  __
//     \  /  /\  |__) |  /\  |__) |    |__  /__`
//      \/  /~~\ |  \ | /~~\ |__) |___ |___ .__/
//
//------------------------------------------------------------------------------
volatile static uint8_t seq = 0;
//------------------------------------------------------------------------------
//      __   __   __  ___  __  ___      __   ___  __
//     |__) |__) /  \  |  /  \  |  \ / |__) |__  /__`
//     |    |  \ \__/  |  \__/  |   |  |    |___ .__/
//
//------------------------------------------------------------------------------
void seven_seg_write(uint8_t number);
static uint8_t bcd_converter(uint8_t digit);
//------------------------------------------------------------------------------
//      __        __          __
//     |__) |  | |__) |    | /  `
//     |    \__/ |__) |___ | \__,
//
//------------------------------------------------------------------------------

//==============================================================================

void seven_seg_write(uint8_t number)
{
	switch(seq++)
	{
		case 0 : tlc5928_write(0x0, bcd_converter( (number / (int) pow(10, 0)) % 10)); DDRC = 0b00110000; break;
		case 1 : break; //pause do nothing
		case 2 : DDRC = 0x00; break; // Turn off
		case 3 : tlc5928_write(0x0, bcd_converter( (number / (int) pow(10, 1)) % 10)); DDRC = 0b00101000; break;
		case 4 : break; //pause do nothing
		case 5 : DDRC = 0x00; break; // Turn off
		case 6 : tlc5928_write(0x0, bcd_converter( (number / (int) pow(10,2)) % 10)); DDRC = 0b00100100; break;
		case 7 : break; //pause do nothing
		case 8 : DDRC = 0x00; break; // Turn off
		case 9 : tlc5928_write(0x0, bcd_converter( ((number / (int) pow(10,3)) % 10)) | 0x80 ); DDRC = 0b00100010; break;
		case 10: break; //pause do nothing
		case 11: DDRC = 0x00; seq = 0; break; // Turn off and reset sequence
		default: DDRC = 0x00; break;
	}
}
//------------------------------------------------------------------------------
//      __   __              ___  ___
//     |__) |__) | \  /  /\   |  |__
//     |    |  \ |  \/  /~~\  |  |___
//
//------------------------------------------------------------------------------
static uint8_t bcd_converter(uint8_t digit) {
	switch (digit)
	{
		case 0x00:  return 0x3F; break;
		case 0x01:  return 0x06; break;
		case 0x02:  return 0x5B; break;
		case 0x03:  return 0x4F; break;
		case 0x04:  return 0x66; break;
		case 0x05:  return 0x6D; break;
		case 0x06:  return 0x7D; break;
		case 0x07:  return 0x07; break;
		case 0x08:  return 0x7F; break;
		case 0x09:  return 0x6F; break;
		case 0x0A:  return 0x77; break;
		case 0x0B:  return 0x7C; break;
		case 0x0C:  return 0x39; break;
		case 0x0D:  return 0x5E; break;
		case 0x0E:  return 0x79; break;
		case 0x0F:  return 0x71; break;
	}
}
//------------------------------------------------------------------------------
//      __                  __        __        __
//     /  `  /\  |    |    |__)  /\  /  ` |__/ /__`
//     \__, /~~\ |___ |___ |__) /~~\ \__, |  \ .__/
//
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
//        __   __  , __
//     | /__` |__)  /__`   
//     | .__/ |  \  .__/
//
//------------------------------------------------------------------------------
